# homework 3  Bomb!

###### 陶伯承 517021910761

## 具体工作

### 导入模型

作业要求构造一个炸弹模型，但是没有给顶点数据，手动造顶点数据显然是不可能的，只有去网上找模型。

找到了一个还算满足要求的炸弹模型，以及一个火柴模型，然后学习了一下 Assimp，把两个模型导入。

### 处理引燃操作

作业要求火柴点到炸弹引信的时候会出现火花。

看到这个要求我的第一想法是捕捉鼠标的点击动作，然后我找到了 glfw 库中的一个函数 `glfwSetMouseButtonCallback`，但是这个函数的参数中并没有鼠标的坐标，即鼠标的点击动作可以被其捕获，但是并不能获取点击的位置，所以还要借助 `glfwSetCursorPosCallback` 函数的帮忙来获取鼠标的实时位置，然后当捕获到点击动作时，这一刻的鼠标位置即为点击位置。

捕捉到点击位置后，要和炸弹引信的位置进行比较。这一步我的做法是当点击位置在以引信位置为中心的一个矩形范围内时，判定为点燃，将一个全局变量记录着的状态置为 “点燃”。

至于火花的渲染，我一开始的想法是找一个火花的模型导进去，但是找了一圈下来没找到，找到的也是要收费的（平均差不多都在 6,7 刀左右），然后只好求助于纹理的帮助。在网上找了张火花的图作为纹理贴到一个小三角上。

### 处理引信变短操作

作业要求引信被点燃后越来越短，火花也随之移动。

我的处理是大致记录下引信的轨迹，然后相应地改变 model 矩阵，使得火花从物体空间变换到世界空间后总是沿着引信的轨迹移动。

这一步还有一个关键的地方，是如何使得引信越烧越短，我的解决方法是利用模板测试。首先开启模板测试，并将其初始化为在模板测试和深度测试都通过时，将模板值设置为 1。然后在渲染循环中，将火花的渲染放在炸弹的渲染之前，在渲染火花的时候，打开模板缓冲的写入，并使其总是能通过模板测试，这样火花划过的轨迹上的模板值就被置为了 1。然后在渲染炸弹时，关闭模板缓冲的写入，并将通过模板测试的条件设置为模板值不等于 1，这样只要引信被火花覆盖到过，就不会再被渲染了。但是还有一点需要注意，就是在渲染循环的每个迭代中，不清除模板缓冲，否则只有当前被火花覆盖的引信不渲染，而不是所有曾被覆盖过的。

### 处理爆炸操作

作业要求火花燃烧到引信尽头，炸弹爆炸并爆出大量的彩色纸屑。

我的处理是在炸弹的区域内随机生成若干小三角形，依据它们与炸弹中心的距离及相对位置，大致计算出爆炸带给它们的初速度，然后水平方向按匀速直线运动处理，竖直方向按匀加速直线运动处理。

至于颜色，我采用的方案是随机变色，然后彩色小三角的旋转我采用的方案是在三个轴上匀速旋转。