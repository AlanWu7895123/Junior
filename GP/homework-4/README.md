# 2D Game: Super Mario

这次作业没有文档的指导一下子迷茫了起来，思来想去最终决定做（复现）一个超级玛丽。

## 游戏设计

在构想要做个什么样的游戏的时候，我是先从作业的要求出发，然后发现超级玛丽能够满足这些条件，于是再结合之前学习的内容思考设计细节。

### “本质体验”透镜

有了超级玛丽这个想法以后，我决定尽量复刻原版的体验，一方面原版的操作模式虽然十分简单但也足够优秀，另一方面对经典的复刻能最大程度地还原最初玩这款游戏时的感觉。

### “惊讶”透镜

在经典版的超级玛丽中，顶问号箱是可以获得金币或者蘑菇的，考虑到作业要求中有一项是生成随机内容，我就加上了一个小功能，问号箱中也可能出现蘑菇怪，这样也能让玩家有眼前一亮的感觉。

### “内生价值”透镜

因为距离上次玩超级玛丽已经过去很久很久了，听到熟悉的 BGM 的时候我自己内心还是会有一些触动。虽然每个人的童年都不一样，但是像超级玛丽这样的经典我觉得多多少少还是能唤起玩家一些美好的回忆的。

### 四要素混搭

因为是要尽量模仿，四要素与原版并没有太大区别。技术上最大的不同可能就是多了 2D 光照；机制和原版没有什么区别；故事的话因为能力有限只做了前两个关卡，没有最后拯救公主的场景，所以可能并不完整；美感上仍旧是熟悉的像素风，但是在第二关中 2D 光照的加入使得场景多了一丝神秘感。

### 风险分析

在进行风险分析时，我还是从作业要求出发，碰撞检测、物理效果、随机内容以及 UI 在之前的作业中已经有涉及过，所以并不是很担心。音效和精灵动画的话主要麻烦在素材的获取以及处理，但是也不会占用太多时间。视差滚动可以用第一关的背景（比如云）来实现，也没有问题。最后就是 2D Lighting 可能需要学习研究一下。

## 功能实现

### 关卡 1-1

首先是背景的制作，先从网上找到一张关卡 1-1 的背景，例如这样：

![](./images/World1-1-raw.png)

但是因为马里奥要和箱子、旗杆交互，而且云是要运动的，所以先将它们从背景中抠掉，留着之后作为 prefab 添加上去，处理完像这样：

![](./images/World1-1.png)

箱子有两种，一种是普通的箱子，一撞就碎的那种（可能叫砖头更合适一些），还有一种就是问号箱，顶一下会有金币或者蘑菇，但是为了实现简单没有蘑菇，加了蘑菇怪。

云的话就和之前一次作业生成平台的方式一样，从左边不断生成新的云，云有两种，一朵的和两朵一起的（就像上次作业有多种平台一样），然后慢慢往右移，到最右边会被回收掉。

旗杆的制作则是将其变成一个 trigger，马里奥碰到以后就会将旗子降下来，然后播放通关的音乐。

至于场景中剩下的管道，台阶等等不会动也没啥变化的，就直接给他们加上一个 collider。

然后再放上一些蘑菇怪和金币，一个关卡就制作完成了。

### 关卡 1-2

1-2 的话和 1-1 的制作流程没有什么不同，首先也是找一张背景，然后把其中的箱子抠掉：

![](./images/World1-2.png)

再经过一系列和之前相同的步骤，以及 2D 光照的处理之后，就变成了这样：

![1585036628373](./images/World1-2-final.png)

确实比原版的更有神秘感一些。2D 光照具体的利用方法是，在场景中的天花板上间隔地排了七个点光源，然后马里奥手里也拿着一个手电筒。

### 整合两个关卡

在 1-1 的最右边，有一个设为 trigger 的管道，马里奥碰到以后就会加载 1-2 的场景。切换场景的过程中 UI 上显示的分数是不能清零的，一开始这个问题困扰了我一段时间，后来我的解决方法是把 score 变量设为 static，这样 LoadScene 的时候它也不会被重新初始化。

### 功能点

+ 碰撞检测：马里奥撞箱子、踩蘑菇怪，以及管道和台阶。
+ 物理效果：马里奥的重力，旗子下落的效果，蘑菇怪撞到障碍物会返回。
+ UI：左上角是得分，右上角是当前关卡和剩余时间，布局和字体都和原版几乎一样。
+ 音效：背景音循环播放，马里奥的跳跃、顶箱子、吃金币、踩蘑菇怪都会有音效，过关和死亡也会有音效。
+ 精灵动画：马里奥的移动、跳跃、死亡，蘑菇怪的移动、死亡，以及问号箱顶了之后就变成铁箱。
+ 视差滚动：第一关的云在慢慢移动，速度和马里奥的移动速度不一样。
+ 随机生成内容：随机生成云（云的位置、形状），问号箱随机生成金币或者蘑菇怪。
+ 2D Lighting：第二关环境中有七个点光源，以及马里奥手上的手电筒。

## Reference

素材网站：<https://www.spriters-resource.com/nes/supermariobros/>

##### Last-modified date: 2020.3.24, 5 p.m.